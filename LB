upstream backend_pool {
    least_conn;
    server 10.0.2.10:8080;
    server 10.0.2.11:8080;
}

server {
    listen 80;

    location / {
        proxy_pass http://backend_pool;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    }
}





sudo yum update -y
sudo yum install python3 -y
python3 --version
python3 app.py

cat > app.py <<EOF
from http.server import BaseHTTPRequestHandler, HTTPServer
class H(BaseHTTPRequestHandler):
    def do_GET(self):
        self.send_response(200)
        self.end_headers()
        self.wfile.write(b"Hello from App Server 1")
HTTPServer(("0.0.0.0",8080),H).serve_forever()
EOF

python3 app.py





sudo yum install nginx -y
sudo systemctl start nginx
sudo systemctl enable nginx


curl http://localhost

sudo nano /etc/nginx/conf.d/app-lb.conf

upstream backend_pool {
    least_conn;
    server 10.0.2.10:8080;
    server 10.0.2.11:8080;
}

server {
    listen 80;

    location / {
        proxy_pass http://backend_pool;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    }
}

sudo nginx -t
sudo systemctl reload nginx
